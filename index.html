<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#1f2937" />
  <title>Manifestation Roulette â€” PWA</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @keyframes fadeUp { from { opacity: 0; transform: translateY(6px)} to {opacity:1; transform: translateY(0)} }
    .fade-up { animation: fadeUp .25s ease-out }
  </style>
  <link id="manifestLink" rel="manifest" href="data:application/manifest+json,{}">
</head>
<body class="min-h-screen bg-slate-950 text-slate-100 antialiased">
  <div class="mx-auto max-w-3xl px-4 py-10">
    <header class="mb-6 text-center">
      <h1 class="text-3xl font-semibold tracking-tight">Manifestation Roulette</h1>
      <p class="mt-2 text-slate-300">Spin to get a method. Shows the name first. Reveal details or spin again.</p>
      <div id="installHint" class="mt-3 hidden text-xs text-slate-400">Tip: On Android Chrome, open the â‹® menu and tap <span class="italic">Install app</span>.</div>
    </header>

    <main class="space-y-4">
      <div class="flex items-center justify-center gap-3">
        <button id="randomBtn" class="rounded-2xl bg-indigo-500 px-5 py-2.5 text-sm font-semibold shadow hover:bg-indigo-400 active:translate-y-px focus:outline-none focus:ring-2 focus:ring-indigo-300">ðŸŽ² Random</button>
        <button id="revealBtn" class="rounded-2xl bg-slate-800 px-5 py-2.5 text-sm font-semibold shadow hover:bg-slate-700 active:translate-y-px focus:outline-none focus:ring-2 focus:ring-slate-500 disabled:opacity-40" disabled>Show details</button>
        <button id="hideBtn" class="rounded-2xl bg-slate-800 px-5 py-2.5 text-sm font-semibold shadow hover:bg-slate-700 active:translate-y-px focus:outline-none focus:ring-2 focus:ring-slate-500 hidden">Hide details</button>
        <button id="installBtn" class="rounded-2xl bg-emerald-500 px-5 py-2.5 text-sm font-semibold shadow hover:bg-emerald-400 active:translate-y-px focus:outline-none focus:ring-2 focus:ring-emerald-300 hidden">Install</button>
      </div>

      <section class="fade-up rounded-3xl bg-slate-900/60 p-6 shadow-xl ring-1 ring-white/10">
        <div id="nameWrap" class="min-h-[3lh] text-center">
          <p id="placeholder" class="text-slate-400">Press <span class="font-medium">Random</span> to draw a method.</p>
          <h2 id="methodName" class="hidden text-2xl font-bold"></h2>
        </div>
        <div id="details" class="mt-5 hidden space-y-3">
          <div>
            <p class="text-sm text-slate-400">Also known as</p>
            <p id="aka" class="text-slate-100"></p>
          </div>
          <div>
            <p class="text-sm text-slate-400">Purpose</p>
            <p id="purpose" class="text-slate-100"></p>
          </div>
          <div>
            <p class="text-sm text-slate-400">When to use</p>
            <p id="when" class="text-slate-100"></p>
          </div>
          <div>
            <p class="text-sm text-slate-400">Typical duration</p>
            <p id="duration" class="text-slate-100"></p>
          </div>
          <div>
            <p class="text-sm text-slate-400">Steps</p>
            <ol id="steps" class="list-decimal space-y-1 pl-5 text-slate-100"></ol>
          </div>
          <div id="notesWrap" class="hidden">
            <p class="text-sm text-slate-400">Notes</p>
            <p id="notes" class="text-slate-100"></p>
          </div>
        </div>
      </section>

      <footer class="pt-2 text-center text-xs text-slate-500">
        Single-file PWA. Host on <a class="underline hover:text-slate-300" href="https://pages.github.com/" target="_blank" rel="noreferrer">GitHub Pages</a>, <a class="underline hover:text-slate-300" href="https://www.netlify.com/" target="_blank" rel="noreferrer">Netlify</a>, or <a class="underline hover:text-slate-300" href="https://vercel.com/" target="_blank" rel="noreferrer">Vercel</a>.
      </footer>
    </main>
  </div>

  <script>
    const methods = [ /* same methods array here, unchanged */ ];

    const randomBtn = document.getElementById('randomBtn');
    const revealBtn = document.getElementById('revealBtn');
    const hideBtn   = document.getElementById('hideBtn');
    const installBtn= document.getElementById('installBtn');
    const installHint= document.getElementById('installHint');

    const placeholder = document.getElementById('placeholder');
    const methodName  = document.getElementById('methodName');
    const details     = document.getElementById('details');
    const akaEl       = document.getElementById('aka');
    const purposeEl   = document.getElementById('purpose');
    const whenEl      = document.getElementById('when');
    const durationEl  = document.getElementById('duration');
    const stepsEl     = document.getElementById('steps');
    const notesWrap   = document.getElementById('notesWrap');
    const notesEl     = document.getElementById('notes');

    let currentIndex = -1;
    let deferredPrompt = null;

    function pickRandomIndex() {
      if (methods.length <= 1) return 0;
      let idx = Math.floor(Math.random() * methods.length);
      if (idx === currentIndex) idx = (idx + 1) % methods.length;
      return idx;
    }

    function showNameOnly(m) {
      placeholder.classList.add('hidden');
      methodName.classList.remove('hidden');
      methodName.textContent = m.name;
      details.classList.add('hidden');
      revealBtn.disabled = false;
      hideBtn.classList.add('hidden');
      revealBtn.classList.remove('hidden');
    }

    function showDetails(m) {
      akaEl.textContent = m.aka || 'â€”';
      purposeEl.textContent = m.purpose || 'â€”';
      whenEl.textContent = m.when || 'â€”';
      durationEl.textContent = m.duration || 'â€”';
      stepsEl.replaceChildren(...(m.steps || []).map(step => { const li = document.createElement('li'); li.textContent = step; return li; }));
      if (m.notes) { notesWrap.classList.remove('hidden'); notesEl.textContent = m.notes; } else { notesWrap.classList.add('hidden'); }
      details.classList.remove('hidden');
      hideBtn.classList.remove('hidden');
      revealBtn.classList.add('hidden');
    }

    randomBtn.addEventListener('click', () => {
      const idx = pickRandomIndex();
      currentIndex = idx;
      const m = methods[idx];
      showNameOnly(m);
    });

    revealBtn.addEventListener('click', () => { if (currentIndex >= 0) showDetails(methods[currentIndex]); });
    hideBtn.addEventListener('click', () => { if (currentIndex >= 0) showNameOnly(methods[currentIndex]); });

    window.addEventListener('keydown', (e) => {
      if (e.key.toLowerCase() === 'r') randomBtn.click();
      if (e.key.toLowerCase() === 's') { if (!details.classList.contains('hidden')) hideBtn.click(); else revealBtn.click(); }
    });

    function makeIconCanvas(size) {
      const c = document.createElement('canvas');
      c.width = c.height = size;
      const ctx = c.getContext('2d');
      ctx.fillStyle = '#4f46e5';
      ctx.fillRect(0, 0, size, size);
      ctx.font = Math.floor(size * 0.55) + 'px system-ui, Segoe UI Emoji, Apple Color Emoji, Noto Color Emoji, sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillStyle = '#ffffff';
      ctx.fillText('ðŸŽ²', size/2, size/2 + (size*0.02));
      return c.toDataURL('image/png');
    }

    const icon192 = makeIconCanvas(192);
    const icon512 = makeIconCanvas(512);

    const manifest = {
      name: 'Manifestation Roulette',
      short_name: 'Manifestation',
      description: 'Spin to get a manifestation method; reveal steps or spin again.',
      start_url: './?utm_source=pwa',
      scope: './',
      display: 'standalone',
      background_color: '#0b1220',
      theme_color: '#1f2937',
      icons: [
        { src: icon192, sizes: '192x192', type: 'image/png', purpose: 'any maskable' },
        { src: icon512, sizes: '512x512', type: 'image/png', purpose: 'any maskable' }
      ]
    };

    const manifestBlob = new Blob([JSON.stringify(manifest)], { type: 'application/manifest+json' });
    const manifestURL = URL.createObjectURL(manifestBlob);
    document.getElementById('manifestLink').setAttribute('href', manifestURL);

    const swCode = `/* same service worker code here */`;
    if ('serviceWorker' in navigator) {
      const swBlob = new Blob([swCode], { type: 'text/javascript' });
      const swURL = URL.createObjectURL(swBlob);
      navigator.serviceWorker.register(swURL, { scope: './' }).catch(console.error);
    }

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.classList.remove('hidden');
      installHint.classList.add('hidden');
    });

    installBtn.addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      deferredPrompt = null;
      installBtn.classList.add('hidden');
    });

    setTimeout(() => { if (!deferredPrompt) installHint.classList.remove('hidden'); }, 1500);
  </script>
</body>
</html>
